syntax = "proto3";

package com.cashpilot.account;

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

import "google/api/annotations.proto";
import "validate/validate.proto";


option java_package = "com.cashpilot.account.proto";
option java_multiple_files = true;


enum BankName {
  BANK_NAME_UNSPECIFIED = 0;
  KASPI = 1;
  HALYK = 2;
}


service AccountService {

  rpc CreateAccount(CreateAccountRequest) returns (Account) {
    option (google.api.http) = {
      post: "/api/v1/accounts"
      body: "*"
    };
  }

  rpc GetAccount(GetAccountRequest) returns (Account) {
    option (google.api.http) = {
      get: "/api/v1/accounts/{account_id}"
    };
  }

  rpc ListAccounts(ListAccountsRequest) returns (ListAccountsResponse) {
    option (google.api.http) = {
      get: "/api/v1/accounts"
    };
  }

  rpc UpdateAccount(UpdateAccountRequest) returns (Account) {
    option (google.api.http) = {
      patch: "/api/v1/accounts/{account_id}"
      body: "*"
    };
  }

  rpc DeleteAccount(DeleteAccountRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/api/v1/accounts/{account_id}"
    };
  }
}


message Account {
  string account_id = 1;
  string user_profile_id = 2;
  BankName bank_name = 3;
  string account_name = 4;
  string currency = 5;
  google.protobuf.Timestamp first_transaction_date = 6;
  google.protobuf.Timestamp last_transaction_date = 7;
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp updated_at = 9;
}



message CreateAccountRequest {

  BankName bank_name = 1 [
    (validate.rules).enum.not_in = 0
  ];

  string account_name = 2 [
    (validate.rules).string = {min_len: 1, max_len: 100}
  ];

  string currency = 3 [
    (validate.rules).string = {in: ["USD", "EUR", "KZT", "GBP", "RUB"]}
  ];
}

message GetAccountRequest {
  string account_id = 1 [
    (validate.rules).string.uuid = true
  ];
}

message ListAccountsRequest {
}

message ListAccountsResponse {
  repeated Account accounts = 1;
}

message UpdateAccountRequest {
  string account_id = 1 [
    (validate.rules).string.uuid = true
  ];

  string account_name = 2 [
    (validate.rules).string = {min_len: 1, max_len: 100}
  ];
}

message DeleteAccountRequest {
  string account_id = 1 [
    (validate.rules).string.uuid = true
  ];
}